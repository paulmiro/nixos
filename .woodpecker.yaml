{
  "labels": { "backend": "local" },
  "platform": "linux/amd64",
  "steps":
    [
      {
        "commands": ["nix flake show"],
        "image": "bash",
        "name": "Nix flake show",
      },
      {
        "commands": ["nix flake check"],
        "image": "bash",
        "name": "Nix flake check",
      },
      {
        "commands":
          [
            "attic login lounge-rocks https://cache.lounge.rocks $ATTIC_KEY --set-default",
          ],
        "image": "bash",
        "name": "Setup Attic",
        "secrets": ["attic_key"],
      },
      {
        "commands":
          [
            "nix build '.#nixosConfigurations.laptop.config.system.build.toplevel' -o 'result-laptop'",
          ],
        "image": "bash",
        "name": "Build laptop",
      },
      {
        "commands":
          ["nix path-info --closure-size -h $(readlink -f 'result-laptop')"],
        "image": "bash",
        "name": "Show laptop info",
      },
      {
        "commands": ["attic push lounge-rocks:nix-cache 'result-laptop'"],
        "image": "bash",
        "name": "Push laptop to Attic",
      },
    ],
}
